{% extends "base.html" %}
{% block title %}Importar Inventario{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10 col-xl-9">
        <div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-4 border-bottom">
            <h1 class="h2 text-primary"><i class="bi bi-file-earmark-arrow-up me-2"></i> Importar Inventario desde CSV</h1>
        </div>

        <div class="card shadow mb-5">
            <div class="card-header bg-light">
                <h5 class="m-0 text-dark"><i class="bi bi-info-circle me-2"></i> Guía Rápida para la Importación</h5>
            </div>
            <div class="card-body">
                <p><strong>1. Formato:</strong> El archivo debe ser un **CSV** (delimitado por comas, punto y coma o tabulación) con codificación **UTF-8**.</p>
                <p><strong>2. Sobrescritura:</strong> Si un producto ya existe con el mismo **Nombre del Producto**, su información y cantidad serán **actualizadas**.</p>
                <p class="alert alert-info py-2 my-3">
                    <i class="bi bi-arrow-down-up me-1"></i> Asegúrate de que los encabezados coincidan **exactamente** con los nombres a continuación.
                </p>

                <h6 class="font-weight-bold text-dark border-bottom pb-2 mt-4">Campos de Columna Requeridos (*) y Opcionales</h6>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card h-100 bg-light border-primary border-3">
                            <div class="card-header text-primary fw-bold"><i class="bi bi-check-circle-fill me-1"></i> CAMPOS OBLIGATORIOS</div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item"><strong>nombre (*)</strong>: Nombre único del producto.</li>
                                <li class="list-group-item"><strong>cantidad (*)</strong>: Cantidad numérica (puede ser decimal).</li>
                                <li class="list-group-item"><strong>unidad_medida (*)</strong>: Unidad abreviada (Ej. "g", "kg", "ml", "l").</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100 border-secondary border-3">
                            <div class="card-header fw-bold text-secondary"><i class="bi bi-list-task me-1"></i> CAMPOS OPCIONALES</div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item"><strong>ubicacion</strong>, <strong>estante</strong>: Ubicación de Almacén.</li>
                                <li class="list-group-item"><strong>nombre_cana</strong>, <strong>nombre_IUPAC</strong>, <strong>formula_molecular</strong>: Identificación Química.</li>
                                <li class="list-group-item"><strong>cast_sigmg</strong>: Número CAST/SIGMG.</li>
                                <li class="list-group-item"><strong>estado_fisico</strong>: ("sólido", "líquido", "gas").</li>
                                <li class="list-group-item"><strong>estado</strong>: Envase ("abierto", "cerrado").</li>
                                <li class="list-group-item"><strong>ubicacion_actual</strong>: Área de uso (Ej. "lesqo", "loefba", "otro").</li>
                                <li class="list-group-item"><strong>otra_ubicacion_actual</strong>: Detalles si la anterior es 'otro'.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card shadow mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="m-0"><i class="bi bi-cloud-upload me-2"></i> Subir Archivo</h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="form-group mb-4">
                        <label for="archivo_csv" class="form-label fw-bold">Seleccionar Archivo CSV para Importar:</label>
                        <input type="file" class="form-control" id="archivo_csv" name="archivo_csv" accept=".csv" required>
                    </div>
                    <button type="submit" class="btn btn-success btn-lg"><i class="bi bi-upload me-1"></i> Subir e Importar</button>
                    <a href="{{ url_for('inventario_completo') }}" class="btn btn-secondary btn-lg">Cancelar</a>
                </form>
            </div>
        </div>
        
        {% if errors %}
        <div class="card shadow mb-4 border-danger border-3">
            <div class="card-header py-3 bg-danger text-white">
                <h5 class="m-0"><i class="bi bi-x-octagon-fill me-2"></i> Detalles de Errores de Importación</h5>
            </div>
            <div class="card-body">
                <p class="text-danger fw-bold">La importación falló debido a los siguientes problemas. Todos los cambios fueron revertidos:</p>
                <ul class="list-unstyled">
                    {% for error in errors %}
                        <li class="text-danger"><i class="bi bi-arrow-right-short"></i> {{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}